{% extends 'base.html.twig' %}

{# Titre de la page #}
{% block title %}Profil{% endblock %}

{# contenu de la page profil #}
{% block body %}

<div class="container">

    <div class="row gutters-sm mt-5">

        <!-- Profil -> avatar, pseudo et role  -->
        <div class="col-md-4 mb-3">
            <div class="card" style="height: 280px;">
                <div class="card-body bg-darkblue text-white">
                    <div class="d-flex flex-column align-items-center text-center">

                        {% if userForum.avatar is null %}
                        <img class="img-thumbnail img-fluid"
                            src="{{ asset('images/profil_default.jpg')|imagine_filter('avatar') }}" alt="avatar">
                        {% else %}
                        <img class="img-thumbnail img-fluid"
                            src="{{ asset('images/usersAvatar/' ~ userForum.avatar)|imagine_filter('avatar') }}"
                            alt="avatar">
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- détail du profil -> pseudo, date d'inscription, role et nombre de messages + bouton edit  -->
        <div class="col-md-8">
            <div class="card mb-3" style="height: 280px;">
                <div class="card-body bg-darkblue text-white">
                    <div class="row">
                        <div>
                            <h5 class="mb-0 text-capitalize">Pseudo : {{ userForum.pseudonym }}</h5>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div>
                            <h5 class="mb-0">Date d'inscription : {{ userForum.registrationDate|date("d/m/Y à H\\hi") }}</h5>
                        </div>
                    </div>
                    <hr>
                    <div>
                        <h5 class="mb-0 p-1 ">Statut : {{ userForum.roles[0]|renameRole }}</h5>
                    </div>
                    <hr>
                    <div class="row">
                        <div>
                            <h5 class="mb-0">Nombre total de messages postés : {{ comments|length }} </h5>
                        </div>
                    </div>
                    <hr>
                </div>
            </div>
        </div>
    </div>


    <div class="row mt-2">
        <div class="card bg-darkblue">
            <div class="card-body bg-darkblue text-white">
                <div>
                    <div class="col-12">
                        <h4 class="mb-0 text-center">Description </h4>
                    </div>
                    {% if userForum.description is null %}
                        <div class="mt-1 text-secondary text-center">
                            <p>Aucune description</p>
                        </div>
                    {% else %}
                        <div class="mt-1 text-center text-break">
                            {{ userForum.description|purify }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {# Affiche le nombre message#}
    <div class="row">
        <p class="col-12 text-center mt-4">Nombre total de message : {{ comments|length }} </p>
    </div>


    <h1>Messages postés </h1>

    <div class="row mt-2">

        <!-- Derniers message postés -->
        {% for comment in comments %}
        <div class="col-12 mt-3 ">
            <div class="row">

                <div class="row topic-forum bg-dark border border-dark border-3 p-0 g-0
                            d-flex flex-column flex-lg-row">

                    <!-- Profil de l'utilisateur (pseudo, rôle, photo de profil si il y'en as une, date d'inscription, nombre de messages) (bonne chance pour le
                    responsive) -->
                    <div class=" col-12 col-lg-3 col-xl-2 d-flex ">
                        <div class="col-12 d-flex bg-dark">

                            <!-- détails profil-->
                            <div class="rounded bg-darkblue p-lg-3 d-flex flex-grow-1 d-flex flex-row flex-lg-column ">
                                <a href="{{ path('main_profil') }}">{% if userForum.avatar is null %}
                                    <img class="img-thumbnail img-fluid bg-darkblue rounded mb-3 mb-lg-5 offset-2 col-8 mt-2 offset-lg-1 col-lg-10 mt-0 p-3"
                                        src="{{ asset('images/profil_default.jpg')|imagine_filter('avatar') }}" alt="avatar">
                                    {% else %}
                                    <img class="img-thumbnail img-fluid bg-darkblue rounded mb-3 mb-lg-5 offset-2 col-8 mt-2 offset-lg-1 col-lg-10 mt-0 p-3"
                                        src="{{ asset('images/usersAvatar/' ~ userForum.avatar)|imagine_filter('avatar') }}"
                                        alt="avatar">
                                    {% endif %}
                                </a>
                            </div>
                        </div>
                    </div>

                    <!--  content col-10 -->
                    <div class="col-12 col-lg-9 col-xl-10 bg-light d-flex flex-column">
                        <div class=" flex-grow-1 p-4">
                            <div class="row">
                                <div class="titre-forum  m-0 d-flex flex-column flex-lg-row px-3 py-2 justify-content-between">
                                    <div class="px-1 py-1"><span><i class="far fa-clock px-1"></i></span>{{ comment.publicationDate|date("d/m/Y à H\\hi") }}
                                    </div>
                                    <div class="px-0 py-0 text-capitalize">
                                        <a href="{{ path('forum', { slug:comment.forum.slug}) }}" class=" px-1 py-1  " >{{ comment.forum.title }}</a>
                                    </div>
                                </div>
                            </div>
                            <div class=" mt-3 text-break">
                                <p>{{ comment.content|purify }}</p>
                            </div>
                        </div>

                        <hr>

                        {# Si l'utilisateur  #}
                        {% if comment.author == app.user or is_granted('ROLE_MODERATOR') %}
                        <div class="d-flex justify-content-end me-2">
                            <div class="p-2 ">
                                <a class=" btn btn-darkblue "
                                   href="{{ path('comment_edit', { id : comment.id }) }}">Editer le contenu</a>
                            </div>
                            {% if is_granted('ROLE_MODERATOR') %}
                            <div class="p-2 ">
                                <a onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette discussion ?')"
                                   class=" btn btn-darkblue "
                                   href="{{ path('comment_delete', { id : comment.id, csrf_token : csrf_token('comment_delete' ~ comment.id ) }) }}">Supprimer le message
                                </a>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>

                </div>
            </div>
        </div>

        {% else %}

        <p class="col-12 text-center alert bg-lightblue">Aucune publication à afficher.</p>

        {% endfor %}
    </div>
</div>

{% endblock %}